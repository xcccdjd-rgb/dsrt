<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Photos Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: sans-serif; background-color: #f3f4f6; margin:0; padding:0; }
.canvas-container { position: relative; width: 100%; max-width: 1200px; height: 500px; border: 2px dashed #9ca3af; background: #fff; margin: auto; overflow: hidden; }
.layer { position: absolute; cursor: move; transition: transform 0.1s, opacity 0.1s; user-select: none; }
.layer:hover { opacity: 0.9; transform: scale(1.02); }
.layer.selected { outline: 2px dashed #3b82f6; outline-offset: 2px; }
#thumbnailBar { display: flex; overflow-x: auto; gap: 8px; padding: 8px 0; }
#thumbnailBar img { width: 100px; height: 60px; object-fit: cover; cursor: pointer; border: 2px solid transparent; border-radius: 4px; }
#thumbnailBar img:hover { transform: scale(1.1); transition: transform 0.1s; }
#thumbnailBar img.selected { border-color: #3b82f6; }
.accordion-button { width: 100%; text-align: left; background-color: #e5e7eb; padding: 0.5rem 1rem; border-radius: 0.375rem; margin-bottom: 0.25rem; cursor: pointer; }
.accordion-content { display: none; padding: 0.5rem 1rem; background-color: #f9fafb; border-left: 2px solid #3b82f6; border-right: 2px solid #3b82f6; border-bottom: 2px solid #3b82f6; border-radius: 0 0 0.375rem 0.375rem; margin-bottom: 0.5rem; }
#toolbar button:hover { transform: scale(1.05); transition: transform 0.1s; }
@media (max-width:768px){#toolbar button,#toolbar select{flex:none;margin-right:4px;margin-bottom:4px}#toolbar{overflow-x:auto;display:flex;flex-wrap:nowrap}}
</style>
</head>
<body class="p-4">

<!-- Dashboard -->
<div id="dashboard" class="max-w-6xl mx-auto p-4">
  <h1 class="text-3xl font-bold mb-4">Dashboard</h1>
  <div class="flex gap-4 mb-4 flex-wrap">
    <button id="homeBtn" class="px-4 py-2 bg-gray-300 rounded">Home</button>
    <button id="galleryBtn" class="px-4 py-2 bg-gray-300 rounded">Gallery</button>
    <button id="smartPhotosBtn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Smart Photos</button>
  </div>
  <div id="dashboardContent" class="bg-white p-4 rounded shadow">
    <p>Konten dashboard utama di sini...</p>
  </div>
</div>

<!-- Smart Photos -->
<div id="smartPhotosContainer" class="hidden max-w-6xl mx-auto p-4">
  <h1 class="text-3xl font-bold mb-4 text-center">Smart Photos Pro</h1>

  <div class="accordion">

    <!-- Upload Panel -->
    <div>
      <button class="accordion-button">Upload Foto</button>
      <div class="accordion-content">
        <button id="uploadBtn" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">Upload</button>
        <input type="file" id="fileInput" multiple class="hidden">
      </div>
    </div>

    <!-- Canvas Panel -->
    <div>
      <button class="accordion-button">Canvas & Layers</button>
      <div class="accordion-content">
        <div id="canvasContainer" class="canvas-container"></div>
        <div id="thumbnailBar" class="mt-2"></div>
      </div>
    </div>

    <!-- Toolbar Panel -->
    <div>
      <button class="accordion-button">Toolbar & Tools</button>
      <div class="accordion-content" id="toolbar">
        <button id="addText" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">Text</button>
        <button id="addSticker" class="bg-purple-500 text-white px-3 py-1 rounded hover:bg-purple-600">Sticker</button>
        <button id="undo" class="bg-gray-300 px-3 py-1 rounded hover:bg-gray-400">Undo</button>
        <button id="redo" class="bg-gray-300 px-3 py-1 rounded hover:bg-gray-400">Redo</button>
        <select id="resolution" class="border px-2 py-1 rounded">
          <option value="600">600px</option>
          <option value="1080">1080p</option>
          <option value="2048">2K</option>
          <option value="3840">4K</option>
          <option value="8000">8K AI</option>
          <option value="original">Original</option>
        </select>
        <button id="downloadBtn" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">Download</button>
        <button id="backToDashboard" class="bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600">Back</button>
      </div>
    </div>

  </div>
</div>

<script>
// Dashboard navigation
const dashboard=document.getElementById('dashboard');
const smartPhotosContainer=document.getElementById('smartPhotosContainer');
document.getElementById('smartPhotosBtn').addEventListener('click',()=>{dashboard.classList.add('hidden');smartPhotosContainer.classList.remove('hidden');});
document.getElementById('backToDashboard').addEventListener('click',()=>{smartPhotosContainer.classList.add('hidden');dashboard.classList.remove('hidden');canvasContainer.innerHTML='';thumbnailBar.innerHTML='';layers=[];undoStack=[];redoStack=[];});

// Accordion
document.querySelectorAll('.accordion-button').forEach(btn=>{btn.addEventListener('click',()=>{const c=btn.nextElementSibling;c.style.display=c.style.display==='block'?'none':'block';});});

// Smart Photos logic
const uploadBtn=document.getElementById('uploadBtn');
const fileInput=document.getElementById('fileInput');
const canvasContainer=document.getElementById('canvasContainer');
const thumbnailBar=document.getElementById('thumbnailBar');
const undoBtn=document.getElementById('undo');
const redoBtn=document.getElementById('redo');
const addTextBtn=document.getElementById('addText');
const addStickerBtn=document.getElementById('addSticker');
const downloadBtn=document.getElementById('downloadBtn');
const resolution=document.getElementById('resolution');

let layers=[]; let undoStack=[]; let redoStack=[];

// Upload files
uploadBtn.addEventListener('click',()=>fileInput.click());
fileInput.addEventListener('change',handleFiles);

function handleFiles(){const files=fileInput.files;Array.from(files).forEach(file=>{const reader=new FileReader();reader.onload=e=>{const img=document.createElement('img');img.src=e.target.result;img.className='layer';img.style.top='50px';img.style.left='50px';img.style.width='200px';img.style.height='auto';makeDraggable(img);makeResizable(img);canvasContainer.appendChild(img);layers.push(img);addThumbnail(img);saveState();};reader.readAsDataURL(file);});}

// Thumbnail
function addThumbnail(el){const thumb=document.createElement('img');thumb.src=el.src||'';thumb.addEventListener('click',()=>{layers.forEach(l=>l.classList.remove('selected'));el.classList.add('selected');document.querySelectorAll('#thumbnailBar img').forEach(t=>t.classList.remove('selected'));thumb.classList.add('selected');});thumbnailBar.appendChild(thumb);}

// Draggable
function makeDraggable(el){let offsetX,offsetY,isDown=false;el.addEventListener('mousedown',startDrag);el.addEventListener('touchstart',startDrag);function startDrag(e){isDown=true;const clientX=e.touches?e.touches[0].clientX:e.clientX;const clientY=e.touches?e.touches[0].clientY:e.clientY;offsetX=clientX-el.getBoundingClientRect().left;offsetY=clientY-el.getBoundingClientRect().top;layers.forEach(l=>l.classList.remove('selected'));el.classList.add('selected');}document.addEventListener('mousemove',drag);document.addEventListener('touchmove',drag);function drag(e){if(!isDown)return;const clientX=e.touches?e.touches[0].clientX:e.clientX;const clientY=e.touches?e.touches[0].clientY:e.clientY;el.style.left=(clientX-canvasContainer.getBoundingClientRect().left-offsetX)+'px';el.style.top=(clientY-canvasContainer.getBoundingClientRect().top-offsetY)+'px';}document.addEventListener('mouseup',endDrag);document.addEventListener('touchend',endDrag);function endDrag(){if(isDown){isDown=false;saveState();}}}

// Resizable
function makeResizable(el){el.style.position='absolute';const resizer=document.createElement('div');resizer.style.width='10px';resizer.style.height='10px';resizer.style.background='#3b82f6';resizer.style.position='absolute';resizer.style.right='0';resizer.style.bottom='0';resizer.style.cursor='se-resize';el.appendChild(resizer);resizer.addEventListener('mousedown',initResize);resizer.addEventListener('touchstart',initResize);function initResize(e){e.preventDefault();document.addEventListener('mousemove',startResize);document.addEventListener('mouseup',stopResize);document.addEventListener('touchmove',startResize);document.addEventListener('touchend',stopResize);}function startResize(e){const clientX=e.touches?e.touches[0].clientX:e.clientX;const clientY=e.touches?e.touches[0].clientY:e.clientY;const rect=el.getBoundingClientRect();el.style.width=clientX-rect.left+'px';el.style.height=clientY-rect.top+'px';}function stopResize(){document.removeEventListener('mousemove',startResize);document.removeEventListener('mouseup',stopResize);document.removeEventListener('touchmove',startResize);document.removeEventListener('touchend',stopResize);saveState();}}

// Undo / Redo
function saveState(){const state=layers.map(l=>({type:l.tagName.toLowerCase(),src:l.src||null,text:l.innerText||null,top:l.style.top,left:l.style.left,width:l.style.width,height:l.style.height,filter:l.style.filter||'none'}));undoStack.push(JSON.stringify(state));}
undoBtn.addEventListener('click',()=>{if(undoStack.length>1){redoStack.push(undoStack.pop());restoreState(JSON.parse(undoStack[undoStack.length-1]));}});
redoBtn.addEventListener('click',()=>{if(redoStack.length>0){const state=JSON.parse(redoStack.pop());restoreState(state);undoStack.push(JSON.stringify(state));}});
function restoreState(state){canvasContainer.innerHTML='';layers=[];state.forEach(l=>{let el;if(l.type==='img'){el=document.createElement('img');el.src=l.src;}else{el=document.createElement('div');el.innerText=l.text;el.style.color='#000';}el.className='layer';el.style.top=l.top;el.style.left=l.left;el.style.width=l.width;el.style.height=l.height;el.style.filter=l.filter;makeDraggable(el);makeResizable(el);canvasContainer.appendChild(el);layers.push(el);addThumbnail(el);});}

// Add Text Layer
addTextBtn.addEventListener('click',()=>{const text=prompt("Masukkan teks:");if(!text)return;const div=document.createElement('div');div.innerText=text;div.className='layer';div.style.top='50px';div.style.left='50px';div.style.fontSize='24px';div.style.fontWeight='bold';div.style.color='#000';makeDraggable(div);makeResizable(div);canvasContainer.appendChild(div);layers.push(div);addThumbnail(div);saveState();});

// Add Sticker Layer
addStickerBtn.addEventListener('click',()=>{const stickerUrl=prompt("Masukkan URL sticker/emoji:");if(!stickerUrl)return;const img=document.createElement('img');img.src=stickerUrl;img.className='layer';img.style.width='100px';img.style.height='auto';img.style.top='50px';img.style.left='50px';makeDraggable(img);makeResizable(img);canvasContainer.appendChild(img);layers.push(img);addThumbnail(img);saveState();});

// Filter Live per Layer
const filterSelect=document.createElement('select');
filterSelect.innerHTML=`
  <option value="none">No Filter</option>
  <option value="grayscale(100%)">Grayscale</option>
  <option value="sepia(100%)">Sepia</option>
  <option value="invert(100%)">Invert</option>
  <option value="blur(3px)">Blur</option>
  <option value="contrast(150%)">Contrast</option>
  <option value="brightness(150%)">Brightness</option>
`;
document.getElementById('toolbar').appendChild(filterSelect);
filterSelect.addEventListener('change',()=>{const selectedLayer=layers.find(l=>l.classList.contains('selected'));if(selectedLayer){selectedLayer.style.filter=filterSelect.value;saveState();}});

// Download Multi-Resolusi
downloadBtn.addEventListener('click',()=>{
  if(!layers.length)return;
  const baseWidth=1200;
  const scale=resolution.value!=='original'?resolution.value/baseWidth:1;
  const canvas=document.createElement('canvas');
  canvas.width=baseWidth*scale;
  canvas.height=500*scale;
  const ctx=canvas.getContext('2d');
  layers.forEach(l=>{
    if(l.tagName.toLowerCase()==='img'){
      const img=new Image();
      img.src=l.src;
      img.onload=()=>{const x=parseInt(l.style.left)*scale;const y=parseInt(l.style.top)*scale;const w=parseInt(l.style.width)*scale;const h=parseInt(l.style.height)*scale;ctx.filter=l.style.filter||'none';ctx.drawImage(img,x,y,w,h);};
    } else {ctx.font=`${parseInt(l.style.fontSize||24)*scale}px sans-serif`;ctx.fillStyle=l.style.color||'#000';const x=parseInt(l.style.left)*scale;const y=(parseInt(l.style.top)+parseInt(l.style.fontSize||24))*scale;ctx.fillText(l.innerText,x,y);}
  });
  setTimeout(()=>{const link=document.createElement('a');link.download='smartphoto_canvas.png';link.href=canvas.toDataURL('image/png');link.click();},300);
});
</script>
</body>
</html>
